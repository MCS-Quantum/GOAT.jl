<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working with QuantumOptics.jl · GOAT.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="GOAT.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="GOAT.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GOAT.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../background/Overview/">Background</a></li><li><span class="tocitem">Structure</span><ul><li><a class="tocitem" href="../../core/Ansatz/">Control Ansatze</a></li><li><a class="tocitem" href="../../core/DataStructures/">Core data structures</a></li><li><a class="tocitem" href="../../core/Methods/">Finding optimal controls</a></li><li><a class="tocitem" href="../../core/ReferenceFrames/">Reference frames</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example1/">Single qubit control</a></li><li class="is-active"><a class="tocitem" href>Working with QuantumOptics.jl</a><ul class="internal"><li><a class="tocitem" href="#Imports"><span>Imports</span></a></li><li><a class="tocitem" href="#Defining-the-ControllableSystem-using-QuantumOptics.jl"><span>Defining the <code>ControllableSystem</code> using QuantumOptics.jl</span></a></li><li><a class="tocitem" href="#Defining-the-QOCProblem"><span>Defining the <code>QOCProblem</code></span></a></li><li><a class="tocitem" href="#Defining-a-reduction-map"><span>Defining a reduction map</span></a></li><li><a class="tocitem" href="#Specifying-solver-and-optimization-options"><span>Specifying solver and optimization options</span></a></li><li class="toplevel"><a class="tocitem" href="#Define-the-initial-guess-and-perform-an-optimization"><span>Define the initial guess and perform an optimization</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../recommendations/">Recommendations</a></li><li><a class="tocitem" href="../../core/API_reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Working with QuantumOptics.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Working with QuantumOptics.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/MCS-Quantum/GOAT.jl/blob/main/docs/src/examples/example2.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Optimizing-a-custom-pulse-ansatz-for-a-transmon-using-QuantumOptics.jl"><a class="docs-heading-anchor" href="#Optimizing-a-custom-pulse-ansatz-for-a-transmon-using-QuantumOptics.jl">Optimizing a custom pulse-ansatz for a transmon using QuantumOptics.jl</a><a id="Optimizing-a-custom-pulse-ansatz-for-a-transmon-using-QuantumOptics.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Optimizing-a-custom-pulse-ansatz-for-a-transmon-using-QuantumOptics.jl" title="Permalink"></a></h1><p>In this example we will utilize QuantumOptics.jl to define a more complex quantum system – a Duffing oscillator (a good model of a <a href="https://qiskit.org/textbook/ch-quantum-hardware/transmon-physics.html">Transmon</a>). We will also define a custom pulse ansatz using some of the pre-defined basis functions in GOAT.jl.</p><p>The quantum systems that people deal with in a laboratory are very often <em>not</em> qubits. Instead, one defines a qubit subspace within the quanutm system you have access to. For example, a duffing oscillator has the Hamiltonian:</p><p class="math-container">\[H = \omega \hat{n}+\frac{\delta}{2} \hat{n}(\hat{n}-1)\]</p><p>where the frequency of the oscillator is specified by <span>$\omega$</span> and <span>$\delta$</span> defines the anharmonicity (it adds a perturbation that makes different energy levels of the oscillator have different transition frequencies). </p><p>This system has an infinite number of eigenstates that form a ladder-like structure. However, we can define a &quot;qubit&quot; within a 2-dimensional subspace. For instance, we can choose the subspace spanned by the two lowest energy eigenstates: <span>$\{|0 \rangle, |1\rangle \}$</span>. </p><p>In this example, we will use GOAT.jl to find a optimal control that implements a <span>$\pi$</span> rotation within this subspace (i.e, find a unitary <span>$V$</span> s.t. <span>$V|0\rangle \propto |1\rangle$</span> and <span>$V|1\rangle \propto |0\rangle$</span>). This is a much more challenging task than the one explored in Example 1. In particular, we must make sure that the unitary <span>$V$</span> does not connect (or minimially connects) the <span>$|0\rangle$</span> or <span>$|1\rangle$</span> states to any other states of the oscillator. This is a process called leakage. </p><p>Our control term has the form </p><p class="math-container">\[H_c(t) = \Omega(t)(\hat{a} + \hat{a}^\dagger). \]</p><p>Where <span>$\hat{a}$</span> and <span>$\hat{a}^\dagger$</span> are the excitation <a href="https://en.wikipedia.org/wiki/Creation_and_annihilation_operators">anhilation and creation operators</a>, respectively. </p><h2 id="Imports"><a class="docs-heading-anchor" href="#Imports">Imports</a><a id="Imports-1"></a><a class="docs-heading-anchor-permalink" href="#Imports" title="Permalink"></a></h2><pre><code class="language- hljs">using GOAT
using QuantumOptics
using LinearAlgebra, SparseArrays # For instantiating necessary matrices
using OrdinaryDiffEq # Load differetial equation algorithms
using Optim, LineSearches # Load optimization and linesearch algorithms</code></pre><h2 id="Defining-the-ControllableSystem-using-QuantumOptics.jl"><a class="docs-heading-anchor" href="#Defining-the-ControllableSystem-using-QuantumOptics.jl">Defining the <code>ControllableSystem</code> using QuantumOptics.jl</a><a id="Defining-the-ControllableSystem-using-QuantumOptics.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-ControllableSystem-using-QuantumOptics.jl" title="Permalink"></a></h2><p>We first define a Hilbert space using QuantumOptics and then the operators that live on that space:</p><pre><code class="language- hljs">b = FockBasis(3) # A Hilbert space basis using a particle-number cutoff of 3 : span(|0⟩, |1⟩, |2⟩, |3⟩)
a = destroy(b) # The particle anhilation operator
at = create(b) # The particle creation operator
n = number(b) # The particle number operator
Id = identityoperator(b) # The identity operator</code></pre><p>Next, we define the Hamiltonian parameters</p><pre><code class="language-julia hljs">ω = 5*2pi # Setting a oscillator frequency
δ = -0.2*2pi # Setting the oscillator anharmonicity
T = 20.0 # in arbitrary time units</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">20.0</code></pre><p>And finally the Hamiltonian and the control basis operators. (we access the underlying matrix of the QuantumOptics operator using &quot;.data&quot; attribute)</p><pre><code class="language- hljs">H0 = (ω*n+ 0.5*δ*n*(n-Id)).data # Setting the drift component of the Hamiltonian 
Hc = (a+at).data
basis_ops = [Hc] # The operators which define the control basis</code></pre><h3 id="Defining-a-custom-ansatz"><a class="docs-heading-anchor" href="#Defining-a-custom-ansatz">Defining a custom ansatz</a><a id="Defining-a-custom-ansatz-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-custom-ansatz" title="Permalink"></a></h3><p>We will now define a custom pulse ansatz consisting of a sum of sinusoid functions that are modulated with an envelope function that is a flat-topped-cosine. Each ansatz has a different number of parameters for each basis function. For the Fourier basis the parameters are the amplitude, frequency, and phase of each sinusoid. </p><pre><code class="language-julia hljs">N = 1 # The number of basis functions to use to describe the control.
function Ω(p,t,i)
    envelope = flat_top_cosine(t,1,T,0.3*T) # A flat-top cosine envelope for our pulse
    c = fourier_coefficient(p,t,i,N) # The control ansatz is a sum of sinusoidal basis functions
    return c*envelope
end

function ∂Ω(p,t,i,l)
    envelope = flat_top_cosine(t,1,T,0.3*T) # A flat-top cosine envelope for our pulse
    ∂c = ∂fourier_coefficient(p,t,i,l,N) # The derivative of the control ansatz
    return ∂c*envelope
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">∂Ω (generic function with 1 method)</code></pre><p>We now define the reference frame in which we will implement a desired unitary operator:</p><pre><code class="language- hljs">rotating_frame_generator = -Diagonal(Matrix(H0)) # Moving into the reference frame rotating at the oscillator frequencies</code></pre><p>And finally we define the <code>ControllableSystem</code>:</p><pre><code class="language- hljs">sys = ControllableSystem(H0, basis_ops, rotating_frame_generator, Ω, ∂Ω)</code></pre><h2 id="Defining-the-QOCProblem"><a class="docs-heading-anchor" href="#Defining-the-QOCProblem">Defining the <code>QOCProblem</code></a><a id="Defining-the-QOCProblem-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-QOCProblem" title="Permalink"></a></h2><p>In this example, we wish to generate a unitary operator within a subspace of the system&#39;s Hilbert space. This requires that the global unitary operator (which is what we compute by solving the Schrodinger Equation and GOAT EOMs) be block-diagonal with respect to a bipartion of the Hilbert space. We reinforce this constrating by specifying the projectors onto the computational and ancillary subspaces. </p><pre><code class="language- hljs">Pc = (projector(fockstate(b,0))+projector(fockstate(b,1))).data # The projector onto the computational subspace 
# (which is the first two energy levels in this case: |0⟩, |1⟩)
Pa = 0.0*Id.data # The projector onto the ancillary subspaces (which is a null operator in this case)</code></pre><p>the projector <code>Pa</code> can be used to penalize population on higher energy states but we won&#39;t consider that in this example. There are a variety of ways to define the projector <code>Pa</code>. In this example a null operator was chosen because we don&#39;t care what evolution the other subspaces experience.</p><p>Next we define our target unitary operator (effectively a swap operation between states <span>$\ket{0}$</span> and <span>$\ket{1}$</span>). The matrix elements of the unitary outside the computational subspace can be chosen arbitrarily because when computing the objective function they will be projected away by <code>Pc</code>. Here we just modify the identity matrix.</p><pre><code class="language- hljs">U_target = Matrix(Id.data) # We begin by initializing a matrix
U_target[1,1] = 0.0 
U_target[2,2] = 0.0
U_target[1,2] = 1.0
U_target[2,1] = 1.0</code></pre><p>Finally, we define the <code>QOCProblem</code>:</p><pre><code class="language- hljs">prob = QOCProblem(U_target, T, Pc, Pa) # The quantum optimal control problem. </code></pre><h2 id="Defining-a-reduction-map"><a class="docs-heading-anchor" href="#Defining-a-reduction-map">Defining a reduction map</a><a id="Defining-a-reduction-map-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-a-reduction-map" title="Permalink"></a></h2><p>A reduction map defines how the output from the Schrodinger equation (SE) and the GOAT EOMs are manipulated to return the objective function and any associated derivatives. Here we will use an already implemented reduction map that computes a projective SU measure called &quot;infidelity.&quot;</p><pre><code class="language-julia hljs">SE_reduce_map = SE_infidelity_reduce_map
GOAT_reduce_map = GOAT_infidelity_reduce_map</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GOAT_infidelity_reduce_map (generic function with 1 method)</code></pre><h2 id="Specifying-solver-and-optimization-options"><a class="docs-heading-anchor" href="#Specifying-solver-and-optimization-options">Specifying solver and optimization options</a><a id="Specifying-solver-and-optimization-options-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-solver-and-optimization-options" title="Permalink"></a></h2><pre><code class="language- hljs"># Define options for DifferentialEquations.jl (see DifferentialEquation docs for info)
ODE_options = (abstol = 1e-9, reltol= 1e-9, alg=Vern9())

# Define the optimizer options from Optim.jl (See Optim.jl docs for info)
optim_alg = Optim.LBFGS(linesearch=LineSearches.BackTracking()) # A Back-Tracking linesearch
optim_options = Optim.Options(g_tol=1e-12,
                            iterations=10,
                            store_trace=true,
                            show_trace=true, extended_trace=false, allow_f_increases=false)</code></pre><h1 id="Define-the-initial-guess-and-perform-an-optimization"><a class="docs-heading-anchor" href="#Define-the-initial-guess-and-perform-an-optimization">Define the initial guess and perform an optimization</a><a id="Define-the-initial-guess-and-perform-an-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-initial-guess-and-perform-an-optimization" title="Permalink"></a></h1><p>Here we will define our initial guess and specify which parameters are to be optimized, and how parallelization is to proceed:</p><pre><code class="language-julia hljs">p0 = [0.25,ω,0.0] # The initial parameter guesses
opt_param_inds = [1,2,3] # The parameters of the vector p0 to optimize -- all parameters in this case
num_params_per_GOAT = 3 # This parameter specifies how many derivatives are propogated in each GOAT EOMs</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3</code></pre><p>This <code>num_params_per_GOAT</code> variable specifies how many derivatives are propogated in each GOAT EOMs and informs parallelization. </p><p>For example, if <code>num_params_per_GOAT=5</code>and there are 5 total parameters, then no parallelization is performed. In contrast, if <code>num_params_per_GOAT=2</code> and there are 5 total parameters, then 3 processes are run in parallel: the first processor computes the EOMs for 2 parameters, the second process computes the EOMs for 2 parameters, and the third computes the EOMs for 1 parameter. </p><p>Next we put all of these parameters into a <code>QOCParameters</code> struct:</p><pre><code class="language- hljs">params = QOCParameters(ODE_options,SE_reduce_map,GOAT_reduce_map,optim_alg,optim_options; num_params_per_GOAT=num_params_per_GOAT)</code></pre><p>Finally we run our optimization</p><pre><code class="language- hljs">res = find_optimal_controls(p0, opt_param_inds, sys, prob, params)
res</code></pre><p>The converged infidelity should be around 7e-4, higher fidelities are possible. Explore the ansatz, control time, and other parameters to find a better optimum!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example1/">« Single qubit control</a><a class="docs-footer-nextpage" href="../../recommendations/">Recommendations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 2 May 2023 16:53">Tuesday 2 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
